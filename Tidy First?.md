---
tags:
  - book
---
- tidy = 整頓 綺麗にする きちんとする
- 本書ではまず個人としての整頓についての判断について書かれている。チーム、組織としての判断については続刊で解説される。
- 先に整頓すべきか？
	- 判断の材料
		- 整頓によって==コスト==が低くなったり、コストが発生する時期が遅くなったり、コストが発生する可能性が下がったりするか？
		- 整頓によって==収益==が大きくなったり、収益が発生する時期が早くなったり、収益が発生する可能性が上がったりするか？
		- 整頓によってより少ない要素の変更になるか？＝==結合==度が下がって変更が容易になるか？
		- 整頓によって変更が必要な要素が、より小さく、より集中した構造になるか？＝==凝集==度が上がって変更が容易になるか？

- 整頓しない
	- このコードを2度と変更しない
	- 設計の改善から学ぶことはない
- 改めて（別の機会に）整頓する
	- すぐに見返りがない大きなかたまりの整頓を抱えている
	- 整頓を完了することで最終的には見返りがある
	- 小出しに整頓できる
- （変更の）あとに整頓する
	- 将来の整頓まで待つとかえって高くつく
	- あとに整頓しないとやり切った感が得られない
- （変更より）先に整頓する
	- すぐに見返りがある。たとえば、理解が向上したり、振る舞いを安く変更できたりする
	- 何をどのように変更すれば良いかわかってくる
---
第一部 整頓
- 整頓とは何か？→リファクタリングとも言えないくらいの小さな改善
	- ガード節
	- デッドコード
	- シンメトリーを揃える
		- できるだけ同じ書き方に統一する
	- 新しいインターフェース、古い実装
		- 従来のインターフェースが使いにくいなら新しく作る。Adopterパターン。
	- 読む順番
		- 読み手が遭遇したい情報の順に並べる
	- 凝集の順番
		- 凝集度が高まるようにコードを並び替える
	- 変数宣言と初期値を一緒の場所に移動する
	- 説明変数
	- 説明定数
	- 明示的なパラメータ
	- ステートメントを小分けにする
		- コードブロックをチャンクごとに空行で区切る
	- ヘルパーを抽出する
		- コードブロックを関数に抽出する
	- ひとかたまり
		- 分割が下手でかえってわかりにくくなってるコードは、逆にひとかたまりにしてから、改めて整理する
	- 説明コメント
	- 冗長なコメントを削除する
第二部 管理術
- どのように整頓するのか？個人の開発ワークフローに整頓を組み込む方法。
	- 整頓のPRは小さくする。振る舞いの変更と、構造の変更に分けて、それぞれでPRにすべき
	- 整頓はどんどん繋がっていく。やりすぎないように。
	- いつ整頓すべきか？
第三部 理論
- 整頓の裏にある力学
	- 振る舞いと構造
	- ディスカウントキャッシュフローとオプショナリティ
		- 明日の1ドルより今日の1ドル（NPV）。ディスカウントキャッシュフロー。
			- すぐ使える機能が提供されていること。つまり、先に実装して後から整頓すること。
		- カオスな状況下ではモノよりオプションの方が優れて見える（オプショングリークス）。オプション。
			- オプショナリティとは
				- 機能拡張できる余力。拡張性。
				- オプショナリティがビジネスの利益を生み出す
			- 振る舞いの変更可能性が価値を生まれる。つまり、よく整頓されていること。
		- 先に整頓することで全体的な実装コストが下がるならそうすべきだし、そうでないなら後から整頓する
		- 変更は可逆的な方法を選ぶことでリスクを軽減できる
	- 結合と分離
	- 凝集


---
振る舞いとは
- 入出力のペア、および不変条件のこと
	- 入力に対する出力
	- 期待される出力の条件
- 振る舞いが価値を生み出す
- 振る舞いにオプショナリティがあることでシステムの価値が上がる
構造とは
- 大きな関数で実装するか、小さく分けるか
- どちらでも振る舞いは変わらないが、構造がオプショナリティを生み出す
オプショナリティとは
- 機能拡張できる余力。拡張性。
- オプショナリティがビジネスの利益を生み出す

お金の本質。ソフトウェアの経済的価値の源泉
- 明日の1ドルより今日の1ドル（NPV）。ディスカウントキャッシュフロー。
	- すぐ使える機能が提供されていること。つまり、先に実装して後から整頓すること。
- カオスな状況下ではモノよりオプションの方が優れて見える（オプショングリークス）。オプション。
	- 振る舞いの変更可能性に価値が生まれる。つまり、よく整頓されていること。
- 先に整頓することで全体的な実装コストが下がるならそうすべきだし、そうでないなら後から整頓する
- 変更は可逆的な方法を選ぶことでリスクを軽減できる
- 
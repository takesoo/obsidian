---
aliases:
  - RLS
tags:
  - postgresql
---
## what
- 行単位のアクセス制御
- SQLを実行したユーザーによってアクセスできる行に制限を加えることができる
- 仕組み的には、各クエリに対してポリシーというフィルタをを強制的に適用する
## why
- マルチユーザー・マルチテナントで、A社のデータはA社の社員にしか見えないようにすることができる
## how
```sql
-- すべてのテーブルにuser_idまたはtenant_idを持たせる
-- user_idが同じものだけにフィルタされるようにポリシーを定義
USING (user_id = current_setting('app.current_user_id'));
-- アプリケーション側でフィルタしてなくてもDB側で強制的にフィルタされる
```
---
tags:
  - RDB
---
- Server層：[[SQL]]の解析と実行する機能を提供する層
- ストレージエンジン層：データアクセス機能を提供する層
	- MyISAM, [[InnoDB]], Memoryなど
- mysqldump
	- バックアップ
	- スナップショット
- ログ
	- エラーログ：
		- mysqldの起動、実行、停止で発生した問題を記録するログ
		- 目的：障害発生の検知、トラブルシューティング
		- 使用例：サーバーが起動しない。クラッシュ時の原因究明
	- 一般クエリログ：
		- 確立されたクライアント接続およびクライアントから受け取ったすべての[[SQLステートメント]]
		- 目的：デバッグ。異常なアクセスの追跡
	- [[バイナリログ]](binlog)：
		- データを変更するステートメント（`INSERT`, `UPDATE`, `DELETE`）を時系列に記録
		- 目的：レプリケーション（マスター→スレーブ間の同期）、バックアップ（mysqldump + binlogでのPoint-in-Timeリカバリ）
	- リレーログ：
		- レプリケーションソースサーバー（マスター）から受信したbinlog
		- レプリケーションの実行
	- スロークエリーログ：
		- `long_query_time`秒よりも時間を要したクエリ
		- 目的：パフォーマンスチューニング。ボトルネックの特定
	- [[Redoログ]]（InnoDB Redo Log）：
		- データ変更の物理ログ
		- 目的：クラッシュリカバリに使用する
	- [[Undoログ]]（InnoDB Undo Log）：

```sql
クライアント: BEGIN;
↓
MySQL: トランザクション開始
↓
クライアント: INSERT INTO users ...
↓
MySQL:
  - Undoログに変更前の値を記録
  - Redoログに変更内容（ページのバイト差分）を記録（まだフラッシュされていない）
  - Buffer Pool の users ページを更新（ディスクにはまだ書かない）
↓
クライアント: COMMIT;
↓
MySQL:
  - Redoログをディスクにフラッシュ（fsync）
  - Binlog（論理ログ）に INSERT を書き込む（ROWまたはSQL）
  - Binlog もディスクに fsync
  - 両方のfsync完了 → COMMIT完了がクライアントに返る
↓
後でMySQLのバックグラウンドプロセスが変更されたページをディスクに書き込む（フラッシュ）

```
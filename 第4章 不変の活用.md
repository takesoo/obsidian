---
tags:
  - 良いコード悪いコードで学ぶ設計入門
---
- [[ミュータブル]]
	- 変数の値を変更するなど状態変更できること
- [[イミュータブル]]
	- 変数を状態変更できないこと
- 再代入
	- 変数への値の再代入は変数の意味を誤認させる
	- 変数は不変にして再代入を防ぐ
	- 引数も同様に不変にする
- 可変がもたらす意図せぬ影響
	- 可変インスタンスの使い回し
		- インスタンス変数が可変だとインスタンスの使い回しで予期せぬ値の更新が起きてしまう
	- 関数による可変インスタンスの操作
		- 関数がインスタンスに対して副作用を与えてしまう
	- 副作用のデメリット
		- 関数には主作用と副作用がある
			- 主作用：関数（メソッド）が引数を受け取り、値を返すこと
			- 副作用：種作用以外に状態変更すること
				- インスタンス変数の変更
				- グローバル変数の変更
				- 引数の変更
				- ファイルI/O
	- 関数の影響範囲を限定する
		- 関数が次の項目を満たすことを前提に設計する
			- データ、つまり状態を引数で受け取る
			- 状態を変更しない
			- 値は関数の戻り値として返す
		- オブジェクト指向プログラミング言語では、副作用のない関数を厳密に作り込むスタイルよりも、クラスのスコープ内で影響を閉じ込めるスタイルのほうが一般的
	- 不変にして予期せぬ動作を防ぐ
		- インスタンス変数を不変にすることで、メソッドは状態変更後の値を持つインスタンスを生成して返すロジックになる
		- インスタンスが別々になるのでお互いの影響を受けない
- 不変と可変の取り扱い方針
	- デフォルトは不変に
		- 変数の意味が変化しなくなるので、混乱が抑えられる
		- 挙動が安定し、結果を予測しやすくなる
		- コードの影響範囲が限定的になり、保守が容易になる
	- どんな時か変にして良いか
		- マシンパフォーマンス
			- 大量データの酵素高処理
			- 画像処理
			- リソース制約の厳しい組み込みソフトウェア
		- スコープが局所的なケース
			- ループカウンタ
	- 正しく状態変更するメソッドを設計する
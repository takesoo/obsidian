---
tags:
  - オンラインスキーママイグレーションツール
---
## what
- テーブルへの読み書きを維持したまま（ロックなしで）`ALTER TABLE`を実行できる
## why
- ALTER操作はテーブルに対して共有ロックを取得するので、テーブルのレコード数が多い場合はその間書き込みプロセスが待ち状態になりサービスが停止してしまう
- [[MySQL]]5.6からは[[オンラインDDL]]ができるようになったが、すべてのALTER操作に対応できるわけではない

### gh-ostの処理の流れ
1. 変更したいテーブル（**基テーブル**）の空のコピーテーブル（**ゴーストテーブル**）を作成
2. ゴーストテーブルに対して指定したALTERステートメント実行
3. 基テーブルの既存データをゴーストテーブルにコピー
4. マイグレーション実行中、基テーブルへの新規DMLはバイナリログから抽出し、ゴーストテーブルへ適用  
    ※ 3と4は並列で稼働します
5. 3と4が終わると、基テーブルとゴーストテーブルを入替（**カットオーバー**）

## how
- 
---
tags:
  - AWS
---
## what
- AWSフルマネージド型のKey-Value型データベース
- スケールアウト（水平スケール）を得意としている。ユーザーのテーブル操作に対してどのようなスケールが必要か自動で計算する。
- レイテンシー10ms未満のハイパフォーマンス
- 表結合など柔軟なクエリを発行するのは苦手
- ミリ秒単位のアクセスレイテンシーとデータの拡張性が求められるユースケースに向いている
	- ゲーム、広告、金融、IoT、etc...
- データはpartition keyによって決められた位置にsort keyの順に並んでいる
	- partition key: キーによる値へのアクセスの位置
	- sort key: モデルに対して1:nの関係
- オンデマンドキャパシティ: 自動スケーリング。アクセスパターンが予測困難なケース向け。
- プロビジョンドキャパシティ: 読み取り・書き込み容量を事前設定。予測可能なワークロード向け。
### コアコンポーネント
- テーブル
- 項目：RDBでいうレコード
- 属性：RDBでいうカラム
- プライマリキー
	- 以下2種類をサポート
		- パーティションキー
		- パーティションとソートキー（複合プライマリキー）
- セカンダリインデックス
	- RDBでいうインデックス
	- 以下2種類をサポート
		- グローバルセカンダリインデックス(GSI)：パーティションキーおよびソートキーを持つインデックス。テーブルのパーティションキーとソートキーとはことなる場合がある。
		- ローカルセカンダリインデックス(LSI)：パーティションキーはテーブルと同じだがソートキーが異なる。
- DynamoDB Streams：データ追加・変更・削除イベントのリアルタイムキャプチャ
	- [[AWS Lambda|Lambda]]との連携が可能
	- [[AWS Kinesis]]や[[AWS Glue]]との統合
### 読み取り整合性
- 結果整合性のある読み込み
	- 最新の書き込みオペレーションの結果が応答に反映されない場合がある。
	- 強力な整合性のある読み込みの半分のコスト
- 強力な整合性のある読み込み(ConsistentRead)
	- 最新データを含む応答を返す
	- テーブルとセカンダリインデックスのみでサポート。GSIとDynamoDB Streamsはサポートされない
### キャパシティユニット
- DynamoDBにおける1秒あたりの読み込み/書き込み容量のこと

| プロビジョニングするスループットタイプ    | 1時間あたりの料金        | パフォーマンス                             |
| ---------------------- | ---------------- | ----------------------------------- |
| 書き込みキャパシティーユニット (WCU): | 0.000742USD/WCU  | 1WCUは1秒間に1回の書き込み                    |
| 読み込みキャパシティーユニット (RCU): | 0.0001484USD/RCU | 1RCUは1秒間に2回の読み込み、または結果整合性のある1回の読み込み |

### コスト
- 要素は以下
	- キャパシティユニット
		- (WCU1時間あたりの料金 * WCU数 * 24h * 30days) + (RCU1時間あたりの料金 * RCU数 * 24h * 30days)
		- まずは余裕を持って設定し、CloudWatchなどで利用料を監視しながら、徐々に最適化する
		- 利用量が定量であることが見込めるならリザーブドキャパシティの購入も検討する
	- ストレージ容量
		- 毎月最初の25GBの保管は無料
		- それ以降は月額0.285USD/GB
	- データ転送量
		- 1GB/月まで無料
		- それ以降は0.14USD/GB
### DAX(DynamoDB Accelerator)
- インメモリキャッシュ
## how
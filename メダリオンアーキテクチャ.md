## what
- [[データ分析]]において、データを階層（Bronze/Silver/Gold）で管理する手法
- Bronze: 生データそのまま
- Silver: 基本的なクレンジングや型変換
- Gold: 分析
## why
- 各層で目的を分けることで、データの品質を段階的に挙げていくことで、処理が明確になる
- [[データエンジニア]]、[[データアナリスト]]で担当するレイヤーを分担できる
## how
```sql
-- 生データ層（Bronze）
CREATE SCHEMA IF NOT EXISTS bronze;

-- 生データをそのまま格納
CREATE TABLE bronze.factory_records AS 
SELECT * FROM read_parquet('data/raw/snapshot-*.parquet');

-- 整形済みデータ層（Silver）
CREATE SCHEMA IF NOT EXISTS silver;

-- 基本的なクレンジングと型変換
CREATE TABLE silver.factory_records AS
SELECT 
    factory_id,
    customer_id,
    DATE_TRUNC('month', submitted_at) as submission_month,
    record_count,
    CURRENT_DATE as processed_date
FROM bronze.factory_records
WHERE factory_id IS NOT NULL;

-- 分析用データ層（Gold）
CREATE SCHEMA IF NOT EXISTS gold;

-- 月次集計テーブル
CREATE TABLE gold.monthly_submissions AS
SELECT 
    submission_month,
    customer_id,
    COUNT(DISTINCT factory_id) as active_factories,
    SUM(record_count) as total_submissions
FROM silver.factory_records
GROUP BY submission_month, customer_id;
```
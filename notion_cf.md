---
tags:
  - 個人開発
  - メモ
---
notionのページ構成をyamlコードベースで構成管理するしくみを個人開発する
cf = cloudformation

## AS-IS
- 画面ぽちぽちイズTSURAI
	- とにかく時間がかかる
		- データベース・ビューの設定など、あっちをクリック、スクロール、何かと手間
		- 同じような作業を複数のページでぽちぽち。コードになれば一括編集できるのでは？
		- テンプレート作成して既存ページに適応とかしんどい
- 誰かが変更してしまって何が正規かわからなくなる。構成の履歴管理ができれば

## TO-BE
- notionページ構成をcloud formationみたいにyamlコードベースでgit管理できる
	- コマンド一撃でページ生成できちゃう
	- テキストエディタの保管で楽々管理
	- コメントつけられる
	- gitで履歴管理できる

## できること
- 既存ページからテンプレート作成ができる
	- 何階層か下まで取得できるか
		- `has_children == true`の時にそのブロックのchildrenを取得する？
- yamlからページ作成ができる
	- 標準出力に進捗を表示する
	- 作成したページ構成をyamlテンプレート出力して終了
	- DBのテンプレートを適応できるか
		- retrive pageで直接参照はできたけど、database_idから辿る方法がわからない
- yamlを元に既存ページを更新できる
	- 上書き？
	- ページのupdateには二つの方法がある
		- blockごとにupdateのエンドポイントを叩く
			- 愚直に更新
			- 途中で更新に失敗した時？
	- ページのblock全部消してappend blocksを叩く
		- データベースだけ消せないだろうなぁ
- DBのレコードに対してバッチ処理を走らせられる
---
## TODO
- [x] 既存ページからテンプレートを作成できる
- [x] テンプレートからページを作成できる
	- [x] paragraph
	- [x] heading
	- [x] list
	- [x] column
	- [x] callout
	- [x] table
	- [x] データベースも作成
	- [x] ページも作成
- [ ] テンプレートで既存ページを更新できる
- [ ] データベースの構成を管理できる
- [ ] データベースのテンプレートを管理できる
	- 運用としては、UIでテンプレート作成して、コマンドでyaml生成が楽そう
- [ ] DBの既存ページに新しいテンプレートを一括反映できる
	- テンプレートページのblock_childrenを取得して、その内容を全ページに反映させる？
- [ ] DBの既存ページのプロパティを一括変更
	- スクリプトがむずいし必要性も微妙。。。

---
- databaseの作成や更新は難しそう
- APIでアクセストークンも取得できるかも
- 「テンプレート」がyamlとDBテンプレートか紛らわしいかも
- NotionAPIではリンクドデータベースとボタンはサポートされてないらしい
	- child_databaseでtitle=""のものはリンクドデータベースとみなして除外する
- pageのyamlテンプレートとblocksのyamlテンプレートは分けた方が扱いやすいかも
	- 分けた方が作りやすいので一旦そうする
- tableブロックはidとtable_widthをセットで指定するとエラーが返される
	- tableブロックは削除してもretreveできるみたい（時間が経てば削除される？）
- urlプロパティが必要なブロックは有効なurlを渡さないとエラーになる。空文字なども不可
	- videoの場合は埋め込みリンクでないとエラーになる
	- NotionAPIでファイルアップローディングはまだできない
